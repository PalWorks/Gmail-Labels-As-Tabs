{
  "version": 3,
  "sources": ["../../src/utils/storage.ts", "../../src/options.ts"],
  "sourcesContent": ["/**\n * storage.ts\n *\n * Helper functions for interacting with chrome.storage.sync.\n * Provides typed access to the extension's settings.\n */\n\nexport interface Tab {\n    id: string;\n    title: string;       // Display Name\n    type: 'label' | 'hash'; // 'label' for legacy/simple, 'hash' for custom views\n    value: string;       // The label name or full hash string\n}\n\n// Legacy interface for migration\ninterface LegacyTabLabel {\n    name: string;\n    id: string;\n    displayName?: string;\n}\n\nexport interface Settings {\n    tabs: Tab[];\n    // Legacy support for migration\n    labels?: LegacyTabLabel[];\n    theme: 'system' | 'light' | 'dark';\n    showUnreadCount: boolean;\n}\n\nconst DEFAULT_SETTINGS: Settings = {\n    tabs: [],\n    theme: 'system',\n    showUnreadCount: false\n};\n\n/**\n * Retrieves the current settings from storage.\n * Handles migration from legacy 'labels' to 'tabs'.\n */\nexport async function getSettings(): Promise<Settings> {\n    return new Promise((resolve) => {\n        chrome.storage.sync.get(null, (items) => { // Get all items to check for legacy 'labels'\n            const settings = { ...DEFAULT_SETTINGS, ...items } as Settings;\n\n            // Migration Logic: If 'labels' exists but 'tabs' is empty/missing\n            if (settings.labels && settings.labels.length > 0 && (!settings.tabs || settings.tabs.length === 0)) {\n                console.log('Migrating legacy labels to tabs...');\n                settings.tabs = settings.labels.map(l => ({\n                    id: l.id,\n                    title: l.displayName || l.name,\n                    type: 'label',\n                    value: l.name\n                }));\n                // Clear legacy labels to prevent re-migration\n                delete settings.labels;\n                // Save migrated settings immediately\n                chrome.storage.sync.set(settings);\n            }\n\n            resolve(settings);\n        });\n    });\n}\n\n/**\n * Saves the settings to storage.\n * Merges the provided settings with existing ones.\n */\nexport async function saveSettings(newSettings: Partial<Settings>): Promise<void> {\n    const currentSettings = await getSettings();\n    const mergedSettings = { ...currentSettings, ...newSettings };\n    return new Promise((resolve) => {\n        chrome.storage.sync.set(mergedSettings, () => {\n            resolve();\n        });\n    });\n}\n\n/**\n * Adds a new tab to the list.\n */\nexport async function addTab(title: string, value: string, type: 'label' | 'hash' = 'label'): Promise<void> {\n    const settings = await getSettings();\n    const newTab: Tab = {\n        id: crypto.randomUUID(),\n        title: title.trim(),\n        value: value.trim(),\n        type: type\n    };\n\n    // Avoid duplicates based on value\n    if (!settings.tabs.some((t) => t.value === newTab.value)) {\n        settings.tabs.push(newTab);\n        await saveSettings(settings);\n    }\n}\n\n/**\n * Removes a tab by ID.\n */\nexport async function removeTab(tabId: string): Promise<void> {\n    const settings = await getSettings();\n    settings.tabs = settings.tabs.filter((t) => t.id !== tabId);\n    await saveSettings(settings);\n}\n\n/**\n * Updates an existing tab.\n */\nexport async function updateTab(tabId: string, updates: Partial<Tab>): Promise<void> {\n    const settings = await getSettings();\n    const index = settings.tabs.findIndex((t) => t.id === tabId);\n    if (index !== -1) {\n        settings.tabs[index] = { ...settings.tabs[index], ...updates };\n        await saveSettings(settings);\n    }\n}\n\n/**\n * Updates the order of tabs.\n */\nexport async function updateTabOrder(newTabs: Tab[]): Promise<void> {\n    const settings = await getSettings();\n    settings.tabs = newTabs;\n    await saveSettings(settings);\n}\n", "/**\n * options.ts\n *\n * Logic for the options page.\n * Handles adding, removing, and reordering tabs.\n */\n\nimport { getSettings, saveSettings, addTab, removeTab, updateTabOrder, Settings, Tab } from './utils/storage';\n\nconst labelList = document.getElementById('labels-list') as HTMLDivElement;\nconst newLabelInput = document.getElementById('new-label-input') as HTMLInputElement;\nconst addBtn = document.getElementById('add-btn') as HTMLButtonElement;\nconst exportBtn = document.getElementById('export-btn') as HTMLButtonElement;\nconst importBtn = document.getElementById('import-btn') as HTMLButtonElement;\nconst importFile = document.getElementById('import-file') as HTMLInputElement;\nconst themeSelect = document.getElementById('theme-select') as HTMLSelectElement;\n\n// Initial setup and event listeners\ndocument.addEventListener('DOMContentLoaded', async () => {\n    const settings = await getSettings();\n    renderList(); // Initial render of tabs\n\n    // Set initial theme selection\n    if (themeSelect) {\n        themeSelect.value = settings.theme;\n    }\n\n    // Handle Theme Change\n    themeSelect?.addEventListener('change', async () => {\n        const theme = themeSelect.value as 'system' | 'light' | 'dark';\n        await saveSettings({ theme });\n    });\n});\n\n\n// Render the list of tabs\nasync function renderList() {\n    const settings = await getSettings();\n    if (!labelList) return;\n    labelList.innerHTML = '';\n\n    settings.tabs.forEach((tab, index) => {\n        const li = document.createElement('li');\n        li.draggable = true;\n        li.dataset.id = tab.id;\n        li.dataset.index = index.toString();\n\n        li.innerHTML = `\n      <div style=\"display: flex; align-items: center;\">\n        <span class=\"drag-handle\">\u2630</span>\n        <span>${escapeHtml(tab.title)}</span>\n        ${tab.type === 'hash' ? '<small style=\"color:#888; margin-left:4px;\">(Custom)</small>' : ''}\n      </div>\n      <button class=\"remove-btn\" title=\"Remove\">\u2715</button>\n    `;\n\n        // Remove handler\n        const removeBtn = li.querySelector('.remove-btn') as HTMLButtonElement;\n        removeBtn.addEventListener('click', async () => {\n            await removeTab(tab.id);\n            renderList();\n        });\n\n        // Drag events\n        li.addEventListener('dragstart', handleDragStart);\n        li.addEventListener('dragover', handleDragOver);\n        li.addEventListener('drop', handleDrop);\n        li.addEventListener('dragenter', handleDragEnter);\n        li.addEventListener('dragleave', handleDragLeave);\n\n        labelList.appendChild(li);\n    });\n}\n\n// Add new tab\nif (addBtn) {\n    addBtn.addEventListener('click', async () => {\n        const name = newLabelInput.value;\n        if (name) {\n            await addTab(name, name, 'label');\n            newLabelInput.value = '';\n            renderList();\n        }\n    });\n}\n\n// Allow Enter key to submit\nif (newLabelInput) {\n    newLabelInput.addEventListener('keypress', (e) => {\n        if (e.key === 'Enter') {\n            addBtn.click();\n        }\n    });\n}\n\n// Export settings\nif (exportBtn) {\n    exportBtn.addEventListener('click', async () => {\n        const settings = await getSettings();\n        const dataStr = \"data:text/json;charset=utf-8,\" + encodeURIComponent(JSON.stringify(settings));\n        const downloadAnchorNode = document.createElement('a');\n        downloadAnchorNode.setAttribute(\"href\", dataStr);\n        downloadAnchorNode.setAttribute(\"download\", \"gmail_tabs_settings.json\");\n        document.body.appendChild(downloadAnchorNode); // required for firefox\n        downloadAnchorNode.click();\n        downloadAnchorNode.remove();\n    });\n}\n\n// Import settings\nif (importBtn) {\n    importBtn.addEventListener('click', () => {\n        importFile.click();\n    });\n}\n\nif (importFile) {\n    importFile.addEventListener('change', (event) => {\n        const file = (event.target as HTMLInputElement).files?.[0];\n        if (!file) return;\n\n        const reader = new FileReader();\n        reader.onload = async (e) => {\n            try {\n                const content = e.target?.result as string;\n                const settings = JSON.parse(content);\n                if (Array.isArray(settings.tabs)) {\n                    await saveSettings(settings);\n                    renderList();\n                    alert('Settings imported successfully!');\n                } else {\n                    alert('Invalid JSON format.');\n                }\n            } catch (err) {\n                console.error(err);\n                alert('Error parsing JSON.');\n            }\n        };\n        reader.readAsText(file);\n    });\n}\n\n// Drag and Drop Logic\nlet dragSrcEl: HTMLElement | null = null;\n\nfunction handleDragStart(this: HTMLElement, e: DragEvent) {\n    dragSrcEl = this;\n    e.dataTransfer!.effectAllowed = 'move';\n    e.dataTransfer!.setData('text/html', this.innerHTML);\n    this.classList.add('dragging');\n}\n\nfunction handleDragOver(e: DragEvent) {\n    if (e.preventDefault) {\n        e.preventDefault();\n    }\n    e.dataTransfer!.dropEffect = 'move';\n    return false;\n}\n\nfunction handleDragEnter(this: HTMLElement) {\n    this.classList.add('over');\n}\n\nfunction handleDragLeave(this: HTMLElement) {\n    this.classList.remove('over');\n}\n\nasync function handleDrop(this: HTMLElement, e: DragEvent) {\n    if (e.stopPropagation) {\n        e.stopPropagation();\n    }\n\n    if (dragSrcEl !== this) {\n        const settings = await getSettings();\n        const oldIndex = parseInt(dragSrcEl!.dataset.index!);\n        const newIndex = parseInt(this.dataset.index!);\n\n        // Move item in array\n        const item = settings.tabs.splice(oldIndex, 1)[0];\n        settings.tabs.splice(newIndex, 0, item);\n\n        await updateTabOrder(settings.tabs);\n        renderList();\n    }\n    return false;\n}\n\nfunction escapeHtml(text: string) {\n    const map: { [key: string]: string } = {\n        '&': '&amp;',\n        '<': '&lt;',\n        '>': '&gt;',\n        '\"': '&quot;',\n        \"'\": '&#039;'\n    };\n    return text.replace(/[&<>\"']/g, function (m) { return map[m]; });\n}\n\n"],
  "mappings": "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",
  "names": []
}
