{
  "version": 3,
  "sources": ["../../src/utils/storage.ts", "../../src/content.ts"],
  "sourcesContent": ["/**\n * storage.ts\n *\n * Helper functions for interacting with chrome.storage.sync.\n * Provides typed access to the extension's settings.\n */\n\nexport interface TabLabel {\n    name: string;\n    id: string; // Unique ID for drag and drop\n}\n\nexport interface Settings {\n    labels: TabLabel[];\n}\n\nconst DEFAULT_SETTINGS: Settings = {\n    labels: [],\n};\n\n/**\n * Retrieves the current settings from storage.\n */\nexport async function getSettings(): Promise<Settings> {\n    return new Promise((resolve) => {\n        chrome.storage.sync.get(DEFAULT_SETTINGS, (items) => {\n            resolve(items as Settings);\n        });\n    });\n}\n\n/**\n * Saves the settings to storage.\n */\nexport async function saveSettings(settings: Settings): Promise<void> {\n    return new Promise((resolve) => {\n        chrome.storage.sync.set(settings, () => {\n            resolve();\n        });\n    });\n}\n\n/**\n * Adds a new label to the list.\n */\nexport async function addLabel(labelName: string): Promise<void> {\n    const settings = await getSettings();\n    const newLabel: TabLabel = {\n        name: labelName.trim(),\n        id: crypto.randomUUID(),\n    };\n    // Avoid duplicates\n    if (!settings.labels.some((l) => l.name === newLabel.name)) {\n        settings.labels.push(newLabel);\n        await saveSettings(settings);\n    }\n}\n\n/**\n * Removes a label by ID.\n */\nexport async function removeLabel(labelId: string): Promise<void> {\n    const settings = await getSettings();\n    settings.labels = settings.labels.filter((l) => l.id !== labelId);\n    await saveSettings(settings);\n}\n\n/**\n * Updates the order of labels.\n */\nexport async function updateLabelOrder(newLabels: TabLabel[]): Promise<void> {\n    const settings = await getSettings();\n    settings.labels = newLabels;\n    await saveSettings(settings);\n}\n", "/**\n * content.ts\n *\n * Main content script for Gmail Labels as Tabs.\n * Handles DOM injection, navigation monitoring, and tab rendering.\n */\n\nimport { getSettings, Settings, TabLabel, saveSettings, addLabel, removeLabel, updateLabelOrder } from './utils/storage';\n\n// Selectors for Gmail elements\n// We target the main toolbar container to inject below it.\nconst TOOLBAR_SELECTORS = [\n    '.G-atb', // Main toolbar container (often has this class)\n    '.aeF > div:first-child', // Fallback\n];\n\nconst TABS_BAR_ID = 'gmail-labels-as-tabs-bar';\nconst MODAL_ID = 'gmail-labels-settings-modal';\n\nlet currentSettings: Settings | null = null;\nlet observer: MutationObserver | null = null;\n\n/**\n * Initialize the extension.\n */\nasync function init() {\n    currentSettings = await getSettings();\n\n    // Listen for storage changes to update tabs in real-time\n    chrome.storage.onChanged.addListener((changes, area) => {\n        if (area === 'sync' && changes.labels) {\n            currentSettings!.labels = changes.labels.newValue;\n            renderTabs();\n        }\n    });\n\n    // Initial render attempt\n    attemptInjection();\n\n    // Start observing DOM for navigation/loading\n    startObserver();\n\n    // Listen for URL changes (popstate)\n    window.addEventListener('popstate', handleUrlChange);\n}\n\n/**\n * Attempt to inject the tabs bar.\n * Retries if the insertion point isn't found yet.\n */\nfunction attemptInjection() {\n    // If bar exists, check if it's in the right place (top)\n    const existingBar = document.getElementById(TABS_BAR_ID);\n\n    let injectionPoint: Element | null = null;\n    for (const selector of TOOLBAR_SELECTORS) {\n        // We want the visible toolbar\n        const candidates = document.querySelectorAll(selector);\n        for (const el of candidates) {\n            if (el.getBoundingClientRect().height > 0) {\n                injectionPoint = el;\n                break;\n            }\n        }\n        if (injectionPoint) break;\n    }\n\n    if (injectionPoint) {\n        if (!existingBar) {\n            const tabsBar = createTabsBar();\n            injectionPoint.insertAdjacentElement('afterend', tabsBar);\n            renderTabs();\n        } else if (existingBar.previousElementSibling !== injectionPoint) {\n            // Re-attach if moved\n            injectionPoint.insertAdjacentElement('afterend', existingBar);\n        }\n        updateActiveTab();\n    } else {\n        // Retry shortly if not found (Gmail loading)\n        setTimeout(attemptInjection, 500);\n    }\n}\n\n/**\n * Create the container for the tabs.\n */\nfunction createTabsBar(): HTMLElement {\n    const bar = document.createElement('div');\n    bar.id = TABS_BAR_ID;\n    bar.className = 'gmail-tabs-bar';\n    return bar;\n}\n\n/**\n * Render the tabs based on current settings.\n */\nfunction renderTabs() {\n    const bar = document.getElementById(TABS_BAR_ID);\n    if (!bar || !currentSettings) return;\n\n    bar.innerHTML = ''; // Clear existing\n\n    currentSettings.labels.forEach(label => {\n        const tab = document.createElement('a');\n        tab.className = 'gmail-tab';\n        tab.textContent = label.name;\n        tab.href = getLabelUrl(label.name);\n        tab.dataset.label = label.name;\n        bar.appendChild(tab);\n    });\n\n    // Add \"Add Tab\" button\n    const addBtn = document.createElement('div');\n    addBtn.className = 'add-tab-btn';\n    addBtn.innerHTML = '+';\n    addBtn.title = 'Configure Tabs';\n    addBtn.addEventListener('click', (e) => {\n        e.stopPropagation();\n        toggleSettingsModal();\n    });\n    bar.appendChild(addBtn);\n\n    updateActiveTab();\n}\n\n/**\n * Generate the URL for a given label.\n */\nfunction getLabelUrl(labelName: string): string {\n    const encoded = encodeURIComponent(labelName).replace(/%20/g, '+');\n    return `https://mail.google.com/mail/u/0/#label/${encoded}`;\n}\n\n/**\n * Highlight the active tab based on current URL.\n */\nfunction updateActiveTab() {\n    const hash = window.location.hash;\n    const bar = document.getElementById(TABS_BAR_ID);\n    if (!bar) return;\n\n    const tabs = bar.querySelectorAll('.gmail-tab');\n    tabs.forEach(t => {\n        const tab = t as HTMLElement;\n        const labelName = tab.dataset.label;\n        if (!labelName) return;\n\n        const cleanHash = decodeURIComponent(hash.replace('#label/', '').replace(/\\+/g, ' '));\n\n        if (cleanHash === labelName || hash.includes(`#label/${encodeURIComponent(labelName).replace(/%20/g, '+')}`)) {\n            tab.classList.add('active');\n        } else {\n            tab.classList.remove('active');\n        }\n    });\n}\n\nfunction handleUrlChange() {\n    updateActiveTab();\n}\n\nfunction startObserver() {\n    if (observer) observer.disconnect();\n\n    observer = new MutationObserver((mutations) => {\n        attemptInjection();\n        updateActiveTab();\n    });\n\n    observer.observe(document.body, {\n        childList: true,\n        subtree: true,\n    });\n}\n\n// --- Settings Modal Logic ---\n\nfunction toggleSettingsModal() {\n    let modal = document.getElementById(MODAL_ID);\n    if (modal) {\n        modal.remove();\n    } else {\n        createSettingsModal();\n    }\n}\n\nfunction createSettingsModal() {\n    const modal = document.createElement('div');\n    modal.id = MODAL_ID;\n    modal.className = 'gmail-tabs-modal';\n\n    modal.innerHTML = `\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h3>Configure Tabs</h3>\n                <button class=\"close-btn\">\u2715</button>\n            </div>\n            <div class=\"modal-body\">\n                <div class=\"input-group\">\n                    <input type=\"text\" id=\"modal-new-label\" placeholder=\"Label name (e.g. 'Work')\">\n                    <button id=\"modal-add-btn\">Add</button>\n                </div>\n                <ul id=\"modal-labels-list\"></ul>\n            </div>\n        </div>\n    `;\n\n    document.body.appendChild(modal);\n\n    // Event Listeners\n    modal.querySelector('.close-btn')?.addEventListener('click', () => modal.remove());\n    modal.addEventListener('click', (e) => {\n        if (e.target === modal) modal.remove();\n    });\n\n    const addBtn = modal.querySelector('#modal-add-btn') as HTMLButtonElement;\n    const input = modal.querySelector('#modal-new-label') as HTMLInputElement;\n    const list = modal.querySelector('#modal-labels-list') as HTMLUListElement;\n\n    const refreshList = async () => {\n        const settings = await getSettings();\n        list.innerHTML = '';\n        settings.labels.forEach((label, index) => {\n            const li = document.createElement('li');\n            li.innerHTML = `\n                <span>${label.name}</span>\n                <div class=\"actions\">\n                    ${index > 0 ? '<button class=\"up-btn\">\u2191</button>' : ''}\n                    ${index < settings.labels.length - 1 ? '<button class=\"down-btn\">\u2193</button>' : ''}\n                    <button class=\"remove-btn\">\u2715</button>\n                </div>\n            `;\n\n            li.querySelector('.remove-btn')?.addEventListener('click', async () => {\n                await removeLabel(label.id);\n                refreshList();\n            });\n\n            li.querySelector('.up-btn')?.addEventListener('click', async () => {\n                const newLabels = [...settings.labels];\n                [newLabels[index - 1], newLabels[index]] = [newLabels[index], newLabels[index - 1]];\n                await updateLabelOrder(newLabels);\n                refreshList();\n            });\n\n            li.querySelector('.down-btn')?.addEventListener('click', async () => {\n                const newLabels = [...settings.labels];\n                [newLabels[index + 1], newLabels[index]] = [newLabels[index], newLabels[index + 1]];\n                await updateLabelOrder(newLabels);\n                refreshList();\n            });\n\n            list.appendChild(li);\n        });\n    };\n\n    addBtn.addEventListener('click', async () => {\n        if (input.value) {\n            await addLabel(input.value);\n            input.value = '';\n            refreshList();\n        }\n    });\n\n    refreshList();\n}\n\n// Run init\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n} else {\n    init();\n}\n"],
  "mappings": "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",
  "names": []
}
